(function(b,a){if(typeof define==="function"&&define.amd){define(["vendor/zepto.min"],a);}else{b.TokenInput=a(b.Zepto);}})(this,function(c){var a={values:[],use_duplicate:false,max_result:4},d=function(){},b=function(l){var p=function(){var r=this,C=c(r.elems[0]),y=c('<ul class="token-input"></ul>'),i=c('<li class="input input-ing"></li>'),F=c('<input type="text" autocomplete="off" />'),I=c('<div class="autocomplete"></div>'),B=c('<li class="input input-token"></li>'),A=c('<input type="hidden" name="'+r.name+'" />'),K=false,v=0,D=0,j=function(){C.before(y);
y.append(i);y.after(I);i.append(F);var M=[];for(var O=0,N=r.elems.length;O<N;O++){if(typeof r.elems[O].value!=="undefined"&&r.elems[O].value){M.push(r.elems[O].value);
}r.elems[O].remove();}for(var O=0,N=M.length;O<N;O++){L(M[O],M[O]);}r.onChange=w;y.bind("click",G);F.bind("keydown",J);I.on("mouseenter","div",s);I.on("click","div",H);
y.on("mouseenter","li.input-token",q);y.on("click","li.input-token",z);},t=function(){return y.find("li.input-token.hover");},q=function(){c(this).siblings().removeClass("hover");
},z=function(M){M.preventDefault();c(this).addClass("hover");u();},u=function(){t().remove();},w=function(){var M=y.find("li.input-token");M.each(function(){var R=c(this).find("input").val(),O=c(this).find("p").text(),N=false;
for(var Q=0,P=l.values.length;Q<P;Q++){if(l.values[Q].id==R){c(this).find("p").text(l.values[Q].name);N=true;break;}}if(!N){c(this).find("p").text(R);}});
},L=function(N,P){var O=B.clone(),M=A.clone();O.append(M);O.append("<p>"+N+'</p><span class="close"></span>');M.val(P);i.before(O);F.val("");E();},J=function(Q){var V=this,T=c(this).val(),S=Q.keyCode;
switch(S){case 13:case 108:case 188:Q.preventDefault();if(T===""){return;}var U=I.find("div.hover");if(U.length){L(U.text(),U.data("value"));G();}break;
case 40:case 38:Q.preventDefault();if(I.hasClass("active")){var R=I.find("div.hover"),O;if(S==40){O=R.next();}else{O=R.prev();}if(O.length){R.removeClass("hover");
O.addClass("hover");}}break;case 37:case 39:Q.preventDefault();var P=t();if(P.length!==0){var N;if(S===37){N=P.prev();}else{N=P.next();}if(N.length!==0){N.addClass("hover").siblings().removeClass("hover");
if(N.hasClass("input-token")){N.addClass("hover");}N.siblings().removeClass("hover");}}else{if(S===37){y.find("li.input-token").eq(-1).addClass("hover");
}}break;case 27:Q.preventDefault();E();break;case 8:if(T===""){Q.preventDefault();var P=t();if(P.length===0){var M=y.find("li.input-token").eq(-1);if(!M.hasClass("hover")){M.addClass("hover");
}}else{u();}break;}default:if(v&&!K){clearTimeout(v);}K=false;v=setTimeout(function(){K=true;x.apply(V,arguments);},0);break;}},x=function(R){var Q=c(this).val(),P=new RegExp(Q,"i"),M=[],S=[];
if(!l.use_duplicate){y.find("li.input-token > input").each(function(T,U){if(typeof U.value!=="undefined"){S.push(U.value);}});}if(Q===""){E();return;}for(var O=l.values.length;
O--;){if(P.test(l.values[O]["name"])&&c.inArray(l.values[O]["id"]+"",S)===-1){M.push(l.values[O]);if(M.length>=l.max_result){break;}}}if(M.length){I.addClass("active");
var N="";for(var O=M.length;O--;){N+='<div data-value="'+M[O].id+'">'+M[O].name+"</div>";}I.html(N);I.children().eq(0).addClass("hover");}else{E();}},E=function(){I.removeClass("active");
I.empty();},s=function(M){c(this).addClass("hover").siblings().removeClass("hover");},H=function(N){N.preventDefault();var M=I.find("div.hover");if(M.length){L(M.text(),M.data("value"));
G();}},G=function(){F.focus();};j();},g=[];for(var o=0,h=this.length;o<h;o++){var k=this[o],f=k.form,e=k.name,m=false;for(var n=g.length;n--;){if(g[n].form==f&&g[n].name==e){m=true;
g[n].elems.push(k);break;}}if(!m){g.push({form:f,name:e,elems:[k],onChange:d});}}c.each(g,function(){p.apply(this);});return{add:function(i){l.values=c.extend(l.values,i);
c.each(g,function(){this.onChange();});},remove:function(i){console.log("아직 미완성.");c.each(g,function(){this.onChange();});},clear:function(){l.values=[];
c.each(g,function(){this.onChange();});},get:function(){return l.values;}};};return{run:function(e){var f=c.extend({},a),g;if(typeof e==="string"){g=e;
}else{f=c.extend(f,e);g=f.target;}delete f.target;return b.call(document.querySelectorAll(g),f);}};});